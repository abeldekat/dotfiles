#!/bin/bash

thecolors="$HOME/.local/share/colors"
theactivexres="$thecolors/active-theme.Xcolors"
theactivename="$thecolors/active-theme.name"
themappingtovim="$thecolors/xresourcestovim"

thepathtovimthemes="$HOME/.config/nvim/rcfiles"

thetheme=$(basename --suffix=.Xcolors $1)
thefile=$thecolors/xcolors/$thetheme.Xcolors

_change(){
	if [ -f $thefile ] ; then 
		echo $thetheme
		cp $thecolors/xcolors/$thetheme.Xcolors $theactivexres
		echo $thetheme > $theactivename
	else 
		echo "Not a valid theme: $thetheme"
		exit 1
	fi
}

_activate(){
	echo "Merging xresources"
	xrdb -remove $HOME/.Xresources && xrdb -merge $HOME/.Xresources
	echo "Restarting bspwm"
	bspc wm --restart
}

_vim(){
	thevimtheme="$(cat $themappingtovim | grep "$thetheme" | cut -d, -f2)"
	thevimfile="$thepathtovimthemes/theme-$thevimtheme"
	if [ -f $thevimfile ] ; then
		cp "$thevimfile" "$thepathtovimthemes/theme-active.vim"
	fi
	
}

_apply(){
	_change	
	_activate
	_vim
}

_apply
